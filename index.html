<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì¹´ë“œí˜• êµ¬êµ¬ë‹¨ ê²Œì„</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap');
  body { 
    font-family: 'Nanum Gothic', sans-serif; text-align:center; 
    background:#87ceeb; margin:0; padding:0; 
    display:flex; flex-direction:column; justify-content:center; align-items:center; height:100vh;
  }
  h1 { margin:20px 0; }
  .screen { display:none; padding:20px; }
  .card { 
    display:inline-block; width:80px; height:50px; line-height:50px; margin:8px; 
    background:#fff; border-radius:10px; box-shadow:0 3px 5px rgba(0,0,0,0.2); 
    cursor:pointer; font-size:18px; transition:0.2s; 
  }
  .card:hover { transform: scale(1.1); background:#f0e68c; }
  #feedback { font-size:24px; opacity:0; transition:0.5s; margin-top:15px; }
  #hud { margin-top:15px; font-size:16px; }
  .dan-row { display:flex; justify-content:center; margin-top:20px; flex-wrap:wrap; }
</style>
</head>
<body>

<!-- í™ˆ í™”ë©´ -->
<div id="homeScreen" class="screen" style="display:block;">
  <h1>ì¹´ë“œí˜• êµ¬êµ¬ë‹¨ ê²Œì„</h1>
  <p>í”Œë ˆì´í•  ë‹¨ì„ ì„ íƒí•˜ì„¸ìš”</p>
  <div id="danSelect" class="dan-row"></div>
</div>

<!-- ê²Œì„ í™”ë©´ -->
<div id="gameScreen" class="screen">
  <div id="question" style="font-size:22px; margin:15px;"></div>
  <div id="cards"></div>
  <div id="feedback"></div>

  <div id="hud">
    <span id="score">ì ìˆ˜: 0</span> | 
    <span id="wrong">í‹€ë¦° íšŸìˆ˜: 0</span>
  </div>
</div>

<!-- ê²°ê³¼ í™”ë©´ -->
<div id="resultScreen" class="screen">
  <h2>ê²°ê³¼</h2>
  <div id="finalScore" style="font-size:20px; margin:10px;"></div>
  <div id="wrongList" style="font-size:18px; margin-top:15px;"></div>

  <button onclick="showScreen('homeScreen')" 
          style="margin-top:20px; padding:10px 20px; font-size:16px;">
    í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
  </button>
</div>


<script>
let dan = 2, score = 0, wrong = 0;
let currentNum = 1;
const maxNum = 9;
let wrongAnswers = [];

// í™ˆ í™”ë©´ ë‹¨ ìƒì„±
const danSelectDiv = document.getElementById('danSelect');
for(let i=1;i<=9;i++){
  const dCard = document.createElement('div');
  dCard.className='card';
  dCard.innerText=i+'ë‹¨';
  dCard.onclick=()=>startGame(i);
  danSelectDiv.appendChild(dCard);
}

// ê²Œì„ ì‹œì‘
function startGame(selectedDan){
  dan = selectedDan;
  score = 0; 
  wrong = 0; 
  currentNum = 1;
  wrongAnswers = [];

  showScreen('gameScreen');
  updateHUD();
  nextQuestion();
}

// í™”ë©´ ì „í™˜
function showScreen(screenId){
  document.querySelectorAll('.screen').forEach(s=>s.style.display='none');
  document.getElementById(screenId).style.display='block';
}

// ë¬¸ì œ ìƒì„±
function nextQuestion(){
  if(currentNum > maxNum){
    showResult();
    return;
  }
  
  document.getElementById('feedback').style.opacity = 0;
  document.getElementById('question').innerText = `${dan} Ã— ${currentNum} = ?`;
  generateCards();
}

// ë³´ê¸° ì¹´ë“œ ìƒì„±
function generateCards(){
  const cardsDiv = document.getElementById('cards');
  cardsDiv.innerHTML = '';

  let correct = dan * currentNum;
  let answers = [correct];

  while(answers.length < 3){
    let wrongAns = correct + (Math.floor(Math.random()*5)-2);
    if(wrongAns > 0 && !answers.includes(wrongAns)) answers.push(wrongAns);
  }

  answers.sort(()=>Math.random()-0.5);

  answers.forEach(a=>{
    const card = document.createElement('div');
    card.className='card';
    card.innerText = a;
    card.onclick = ()=>checkAnswer(a);
    cardsDiv.appendChild(card);
  });
}

// ì •ë‹µ í™•ì¸
function checkAnswer(ans){
  const fb = document.getElementById('feedback');

  if(ans === dan * currentNum){
    fb.style.color ='green';
    fb.innerText = 'ì •ë‹µ!';
    fb.style.opacity = 1;
    score++;
  } else {
    fb.style.color ='red';
    fb.innerText = 'ì˜¤ë‹µ!';
    fb.style.opacity = 1;
    wrong++;

    wrongAnswers.push({
      question: `${dan} Ã— ${currentNum}`,
      correct: dan * currentNum,
      chosen: ans
    });
  }

  updateHUD();
  currentNum++;

  setTimeout(nextQuestion, 500);
}

// HUD ì—…ë°ì´íŠ¸
function updateHUD(){
  document.getElementById('score').innerText = 'ì ìˆ˜: ' + score;
  document.getElementById('wrong').innerText = 'í‹€ë¦° íšŸìˆ˜: ' + wrong;
}

// ê²°ê³¼ í™”ë©´
function showResult(){
  showScreen('resultScreen');

  document.getElementById('finalScore').innerText =
    `ì´ ì ìˆ˜: ${score} / ${maxNum}`;

  if(wrongAnswers.length === 0){
    document.getElementById('wrongList').innerHTML =
      "<p style='color:green;'>ëª¨ë‘ ë§ì•˜ìŠµë‹ˆë‹¤! ğŸ‰</p>";
  } else {
    let html = "<h3>í‹€ë¦° ë¬¸ì œ</h3><ul style='list-style:none; padding:0;'>";
    wrongAnswers.forEach(item=>{
      html += `<li>${item.question} â†’ ì •ë‹µ: ${item.correct}, ì„ íƒ: ${item.chosen}</li>`;
    });
    html += "</ul>";
    document.getElementById('wrongList').innerHTML = html;
  }
}
</script>

</body>
</html>
